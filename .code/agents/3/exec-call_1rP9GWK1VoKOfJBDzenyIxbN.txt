/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:81:    types.logger.debug("[CodexMCP] Connecting to Codex MCP server...");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:89:    types.logger.debug("[CodexMCP] Connected to Codex");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:95:        console.log("[CodexMCP] Received elicitation request:", request.params);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:99:          types.logger.debug("[CodexMCP] No permission handler set, denying by default");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:113:          types.logger.debug("[CodexMCP] Permission result:", result);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:118:          types.logger.debug("[CodexMCP] Error handling permission request:", error);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:126:    types.logger.debug("[CodexMCP] Permission handlers registered");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:130:    types.logger.debug("[CodexMCP] Starting Codex session:", config);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:139:    console.log("[CodexMCP] Response:", response);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:149:    types.logger.debug("[CodexMCP] Continuing Codex session:", args);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:162:      types.logger.debug("[CodexMCP] Session ID extracted:", this.sessionId);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:165:      types.logger.debug("[CodexMCP] Session ID extracted:", this.sessionId);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:172:            types.logger.debug("[CodexMCP] Session ID extracted from content:", this.sessionId);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:188:    types.logger.debug("[CodexMCP] Session cleared, previous sessionId:", previousSessionId);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:194:    types.logger.debug("[CodexMCP] Storing session for potential resume:", this.sessionId);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:200:    types.logger.debug(`[CodexMCP] Disconnecting; child pid=${pid ?? "none"}`);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:202:      types.logger.debug("[CodexMCP] client.close begin");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:204:      types.logger.debug("[CodexMCP] client.close done");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:206:      types.logger.debug("[CodexMCP] Error closing client, attempting transport close directly", e);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:208:        types.logger.debug("[CodexMCP] transport.close begin");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:210:        types.logger.debug("[CodexMCP] transport.close done");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:217:        types.logger.debug("[CodexMCP] Child still alive, sending SIGKILL");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-BjT2Vmcd.cjs:228:    types.logger.debug("[CodexMCP] Disconnected");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:79:    logger.debug("[CodexMCP] Connecting to Codex MCP server...");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:87:    logger.debug("[CodexMCP] Connected to Codex");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:93:        console.log("[CodexMCP] Received elicitation request:", request.params);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:97:          logger.debug("[CodexMCP] No permission handler set, denying by default");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:111:          logger.debug("[CodexMCP] Permission result:", result);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:116:          logger.debug("[CodexMCP] Error handling permission request:", error);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:124:    logger.debug("[CodexMCP] Permission handlers registered");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:128:    logger.debug("[CodexMCP] Starting Codex session:", config);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:137:    console.log("[CodexMCP] Response:", response);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:147:    logger.debug("[CodexMCP] Continuing Codex session:", args);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:160:      logger.debug("[CodexMCP] Session ID extracted:", this.sessionId);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:163:      logger.debug("[CodexMCP] Session ID extracted:", this.sessionId);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:170:            logger.debug("[CodexMCP] Session ID extracted from content:", this.sessionId);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:186:    logger.debug("[CodexMCP] Session cleared, previous sessionId:", previousSessionId);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:192:    logger.debug("[CodexMCP] Storing session for potential resume:", this.sessionId);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:198:    logger.debug(`[CodexMCP] Disconnecting; child pid=${pid ?? "none"}`);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:200:      logger.debug("[CodexMCP] client.close begin");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:202:      logger.debug("[CodexMCP] client.close done");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:204:      logger.debug("[CodexMCP] Error closing client, attempting transport close directly", e);
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:206:        logger.debug("[CodexMCP] transport.close begin");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:208:        logger.debug("[CodexMCP] transport.close done");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:215:        logger.debug("[CodexMCP] Child still alive, sending SIGKILL");
/opt/homebrew/lib/node_modules/happy-coder/dist/runCodex-CHAghw9e.mjs:226:    logger.debug("[CodexMCP] Disconnected");
/opt/homebrew/lib/node_modules/happy-coder/node_modules/@anthropic-ai/claude-code/cli.js:770:- If you read a file that exists but has empty contents you will receive a system reminder warning in place of file contents.`;var vw9=["allow","deny","ask"];function bw9(A,B){if(!A||!A.permissions)return[];let{permissions:Q}=A,Z=[];for(let G of vw9){let Y=Q[G];if(Y)for(let I of Y)Z.push({source:B,ruleBehavior:G,ruleValue:xH(I)})}return Z}function fw9(A,B){if(!A.allowedTools||A.allowedTools.length<1)return[];let Q=new Set;for(let G of B)if(G.ruleBehavior==="allow"&&G.source==="localSettings")Q.add(r6(G.ruleValue));let Z=new Set;for(let G of A.allowedTools)if(!Q.has(G))Z.add(G);return Array.from(Z)}function hw9(A,B){if(!A.ignorePatterns||A.ignorePatterns.length<1)return[];let Q=new Set;for(let G of B)if(G.ruleBehavior==="deny"&&G.source==="localSettings"&&G.ruleValue.toolName===HZ&&G.ruleValue.ruleContent!==void 0)Q.add(G.ruleValue.ruleContent);let Z=new Set;for(let G of A.ignorePatterns)if(!Q.has(G))Z.add(G);return Array.from(Z).map((G)=>({toolName:HZ,ruleContent:G}))}function w$A(){let A=$9();if(!A.allowedTools&&!A.ignorePatterns)return;let B={...A},Q=fw9(A,_a("localSettings"));if(Q.length>0)IU1({ruleValues:Q.map(xH),ruleBehavior:"allow"},"localSettings");B.allowedTools=[];let Z=hw9(A,_a("localSettings"));if(Z.length>0)IU1({ruleValues:Z,ruleBehavior:"deny"},"localSettings");delete B.ignorePatterns,a8(B)}function WU1(){let A=[],B=$9();for(let Q of B.allowedTools)A.push({source:"projectSettings",ruleBehavior:"allow",ruleValue:xH(Q)});for(let Q of yH)A.push(..._a(Q));return A}function _a(A){let B=U8(A);return bw9(B,A)}function q$A(A){let B=r6(A.ruleValue),Q=U8(A.source);if(!Q||!Q.permissions)return!1;let Z=Q.permissions[A.ruleBehavior];if(!Z||!Z.includes(B))return!1;try{let G={...Q,permissions:{...Q.permissions,[A.ruleBehavior]:Z.filter((I)=>I!==B)}},{error:Y}=Y4(A.source,G);if(Y)return!1;return!0}catch(G){return U1(G instanceof Error?G:new Error(String(G)),fk),!1}}function gw9(){return{permissions:{allow:[],deny:[],ask:[]}}}function IU1({ruleValues:A,ruleBehavior:B},Q){if(A.length<1)return!0;let Z=A.map(r6),G=U8(Q)||gw9();try{let Y=G.permissions||{},I=Y[B]||[],W=new Set(I),J=Z.filter((V)=>!W.has(V));if(J.length===0)return!0;let X={...G,permissions:{...Y,[B]:[...I,...J]}},F=Y4(Q,X);if(F.error)throw F.error;return!0}catch(Y){return U1(Y instanceof Error?Y:new Error(String(Y)),fk),!1}}import{isAbsolute as uw9}from"path";var xa=pB.enum(["userSettings","projectSettings","localSettings","session","cliArg"]),E$A=pB.discriminatedUnion("type",[pB.object({type:pB.literal("addRules"),rules:pB.array(GU1),behavior:pB.enum(["allow","deny","ask"]),destination:xa}),pB.object({type:pB.literal("replaceRules"),rules:pB.array(GU1),behavior:pB.enum(["allow","deny","ask"]),destination:xa}),pB.object({type:pB.literal("removeRules"),rules:pB.array(GU1),behavior:pB.enum(["allow","deny","ask"]),destination:xa}),pB.object({type:pB.literal("setMode"),mode:V$A,destination:xa}),pB.object({type:pB.literal("addDirectories"),directories:pB.array(pB.string()),destination:xa}),pB.object({type:pB.literal("removeDirectories"),directories:pB.array(pB.string()),destination:xa})]);function va(A){if(!A)return[];return A.flatMap((B)=>{switch(B.type){case"addRules":return B.rules;default:return[]}})}function zF(A,B){switch(B.type){case"setMode":return F1(`Applying permission update: Setting mode to '${B.mode}'`),{...A,mode:B.mode};case"addRules":{let Q=B.rules.map((G)=>r6(G));F1(`Applying permission update: Adding ${B.rules.length} ${B.behavior} rule(s) to destination '${B.destination}': ${JSON.stringify(Q)}`);let Z=B.behavior==="allow"?"alwaysAllowRules":B.behavior==="deny"?"alwaysDenyRules":"alwaysAskRules";return{...A,[Z]:{...A[Z],[B.destination]:[...A[Z][B.destination]||[],...Q]}}}case"replaceRules":{let Q=B.rules.map((G)=>r6(G));F1(`Replacing all ${B.behavior} rules for destination '${B.destination}' with ${B.rules.length} rule(s): ${JSON.stringify(Q)}`);let Z=B.behavior==="allow"?"alwaysAllowRules":B.behavior==="deny"?"alwaysDenyRules":"alwaysAskRules";return{...A,[Z]:{...A[Z],[B.destination]:Q}}}case"addDirectories":{F1(`Applying permission update: Adding ${B.directories.length} director${B.directories.length===1?"y":"ies"} with destination '${B.destination}': ${JSON.stringify(B.directories)}`);let Q=new Map(A.additionalWorkingDirectories);for(let Z of B.directories)Q.set(Z,{path:Z,source:B.destination});return{...A,additionalWorkingDirectories:Q}}case"removeRules":{let Q=B.rules.map((W)=>r6(W));F1(`Applying permission update: Removing ${B.rules.length} ${B.behavior} rule(s) from source '${B.destination}': ${JSON.stringify(Q)}`);let Z=B.behavior==="allow"?"alwaysAllowRules":B.behavior==="deny"?"alwaysDenyRules":"alwaysAskRules",G=A[Z][B.destination]||[],Y=new Set(Q),I=G.filter((W)=>!Y.has(W));return{...A,[Z]:{...A[Z],[B.destination]:I}}}case"removeDirectories":{F1(`Applying permission update: Removing ${B.directories.length} director${B.directories.length===1?"y":"ies"}: ${JSON.stringify(B.directories)}`);let Q=new Map(A.additionalWorkingDirectories);for(let Z of B.directories)Q.delete(Z);return{...A,additionalWorkingDirectories:Q}}default:return A}}function ag(A,B){let Q=A;for(let Z of B)Q=zF(Q,Z);return Q}function y10(A){return A==="localSettings"||A==="userSettings"||A==="projectSettings"}function sg(A){if(!y10(A.destination))return;switch(F1(`Persisting permission update: ${A.type} to source '${A.destination}'`),A.type){case"addRules":{F1(`Persisting ${A.rules.length} ${A.behavior} rule(s) to ${A.destination}`),IU1({ruleValues:A.rules,ruleBehavior:A.behavior},A.destination);break}case"addDirectories":{F1(`Persisting ${A.directories.length} director${A.directories.length===1?"y":"ies"} to ${A.destination}`);let Q=U8(A.destination)?.permissions?.additionalDirectories||[],Z=A.directories.filter((G)=>!Q.includes(G));if(Z.length>0){let G=[...Q,...Z];Y4(A.destination,{permissions:{additionalDirectories:G}})}break}case"removeRules":{F1(`Removing ${A.rules.length} ${A.behavior} rule(s) from ${A.destination}`);let Z=(U8(A.destination)?.permissions||{})[A.behavior]||[],G=new Set(A.rules.map(r6)),Y=Z.filter((I)=>!G.has(I));Y4(A.destination,{permissions:{[A.behavior]:Y}});break}case"removeDirectories":{F1(`Removing ${A.directories.length} director${A.directories.length===1?"y":"ies"} from ${A.destination}`);let Q=U8(A.destination)?.permissions?.additionalDirectories||[],Z=new Set(A.directories),G=Q.filter((Y)=>!Z.has(Y));Y4(A.destination,{permissions:{additionalDirectories:G}});break}case"setMode":{F1(`Persisting mode '${A.mode}' to ${A.destination}`),Y4(A.destination,{permissions:{defaultMode:A.mode}});break}case"replaceRules":{F1(`Replacing all ${A.behavior} rules in ${A.destination} with ${A.rules.length} rule(s)`);let B=A.rules.map(r6);Y4(A.destination,{permissions:{[A.behavior]:B}});break}}}function JU1(A){for(let B of A)sg(B)}function XU1(A){try{if(w1().statSync(A).isDirectory()){let Q=N$A(A);return{type:"addRules",rules:[{toolName:"Read",ruleContent:uw9(Q)?`/${Q}/**`:`${Q}/**`}],behavior:"allow",destination:"localSettings"}}}catch{}return}var k10=h.enum(["local","user","project","dynamic","enterprise"]),AR8=h.enum(["stdio","sse","sse-ide","http","sdk"]),_10=h.object({type:h.literal("stdio").optional(),command:h.string().min(1,"Command cannot be empty"),args:h.array(h.string()).default([]),env:h.record(h.string()).optional()}),mw9=h.object({type:h.literal("sse"),url:h.string(),headers:h.record(h.string()).optional(),headersHelper:h.string().optional()}),dw9=h.object({type:h.literal("sse-ide"),url:h.string(),ideName:h.string(),ideRunningInWindows:h.boolean().optional()}),cw9=h.object({type:h.literal("ws-ide"),url:h.string(),ideName:h.string(),authToken:h.string().optional(),ideRunningInWindows:h.boolean().optional()}),lw9=h.object({type:h.literal("http"),url:h.string(),headers:h.record(h.string()).optional(),headersHelper:h.string().optional()}),pw9=h.object({type:h.literal("sdk"),name:h.string()}),x10=h.union([_10,mw9,dw9,cw9,lw9,pw9]);var L$A=h.object({mcpServers:h.record(h.string(),x10)});import{join as nw9}from"path";import{join as v10}from"path";function VU1(){return v10(gT(),"managed-mcp.json")}function FU1(A,B){if(!A)return{};let Q={};for(let[Z,G]of Object.entries(A))Q[Z]={...G,scope:B};return Q}function M$A(A){let B=v10(QA(),".mcp.json");JL(B,JSON.stringify(A,null,2),{encoding:"utf8"})}function iw9(A){let B=[];function Q(G){return G.replace(/\$\{([^}]+)\}/g,(Y,I)=>{let[W,J]=I.split(":-"),X=process.env[W];if(X!==void 0)return X;if(J!==void 0)return J;return B.push(W),Y})}let Z;switch(A.type){case void 0:case"stdio":{let G=A;Z={...G,command:Q(G.command),args:G.args.map(Q),env:G.env?ny(G.env,Q):void 0};break}case"sse":case"http":{let G=A;Z={...G,url:Q(G.url),headers:G.headers?ny(G.headers,Q):void 0};break}case"sse-ide":case"ws-ide":Z=A;break;case"sdk":Z=A;break}return{expanded:Z,missingVars:[...new Set(B)]}}function rg(A,B,Q){if(A.match(/[^a-zA-Z0-9_-]/))throw new Error(`Invalid name ${A}. Names can only contain letters, numbers, hyphens, and underscores.`);let Z=x10.safeParse(B);if(!Z.success){let Y=Z.error.errors.map((I)=>`${I.path.join(".")}: ${I.message}`).join(", ");throw new Error(`Invalid configuration: ${Y}`)}switch(Q){case"project":{let{servers:Y}=BG("project");if(Y[A])throw new Error(`MCP server ${A} already exists in .mcp.json`);break}case"user":{if(z0().mcpServers?.[A])throw new Error(`MCP server ${A} already exists in user config`);break}case"local":{if($9().mcpServers?.[A])throw new Error(`MCP server ${A} already exists in local config`);break}case"dynamic":throw new Error("Cannot add MCP server to scope: dynamic");case"enterprise":throw new Error("Cannot add MCP server to scope: enterprise")}let G=Z.data;switch(Q){case"project":{let{servers:Y}=BG("project"),I={};for(let[J,X]of Object.entries(Y)){let{scope:F,...V}=X;I[J]=V}I[A]=G;let W={mcpServers:I};try{M$A(W)}catch(J){throw new Error(`Failed to write to mcp.json: ${J}`)}break}case"user":{let Y=z0();if(!Y.mcpServers)Y.mcpServers={};Y.mcpServers[A]=G,RA(Y);break}case"local":{let Y=$9();if(!Y.mcpServers)Y.mcpServers={};Y.mcpServers[A]=G,a8(Y);break}default:throw new Error(`Cannot add MCP server to scope: ${Q}`)}}function b10(A,B){switch(B){case"project":{let{servers:Q}=BG("project");if(!Q[A])throw new Error(`No MCP server found with name: ${A} in .mcp.json`);let Z={};for(let[Y,I]of Object.entries(Q))if(Y!==A){let{scope:W,...J}=I;Z[Y]=J}let G={mcpServers:Z};try{M$A(G)}catch(Y){throw new Error(`Failed to remove from .mcp.json: ${Y}`)}break}case"user":{let Q=z0();if(!Q.mcpServers?.[A])throw new Error(`No user-scoped MCP server found with name: ${A}`);delete Q.mcpServers[A],RA(Q);break}case"local":{let Q=$9();if(!Q.mcpServers?.[A])throw new Error(`No project-local MCP server found with name: ${A}`);delete Q.mcpServers[A],a8(Q);break}default:throw new Error(`Cannot remove MCP server from scope: ${B}`)}}function BG(A){switch(A){case"project":{let B=v10(QA(),".mcp.json");if(!w1().existsSync(B))return{servers:{},errors:[]};let{config:Z,errors:G}=o41({filePath:B,expandVars:!0,scope:"project"});return{servers:FU1(Z?.mcpServers,A),errors:G}}case"user":{let B=z0().mcpServers;if(!B)return{servers:{},errors:[]};let{config:Q,errors:Z}=r41({configObject:{mcpServers:B},expandVars:!0,scope:"user"});return{servers:FU1(Q?.mcpServers,A),errors:Z}}case"local":{let B=$9().mcpServers;if(!B)return{servers:{},errors:[]};let{config:Q,errors:Z}=r41({configObject:{mcpServers:B},expandVars:!0,scope:"local"});return{servers:FU1(Q?.mcpServers,A),errors:Z}}case"enterprise":{let B=VU1();if(!w1().existsSync(B))return{servers:{},errors:[]};let{config:Z,errors:G}=o41({filePath:B,expandVars:!0,scope:"enterprise"});return{servers:FU1(Z?.mcpServers,A),errors:G}}}}function ba(A){let{servers:B}=BG("enterprise"),{servers:Q}=BG("user"),{servers:Z}=BG("project"),{servers:G}=BG("local");if(B[A])return B[A];if(G[A])return G[A];if(Z[A])return Z[A];if(Q[A])return Q[A];return null}function WL(){let{servers:A}=BG("enterprise");if(f10())return Y1("tengu_mcp_servers",{enterprise:Object.keys(A).length,global:0,project:0,user:0}),A;let{servers:B}=BG("user"),{servers:Q}=BG("project"),{servers:Z}=BG("local"),G={};for(let[I,W]of Object.entries(Q))if(KU1(I)==="approved")G[I]=W;let Y=Object.assign({},B,G,Z);return Y1("tengu_mcp_servers",{enterprise:0,global:Object.keys(B).length,project:Object.keys(G).length,user:Object.keys(Z).length}),Y}function r41(A){let{configObject:B,expandVars:Q,scope:Z,filePath:G}=A,Y=L$A.safeParse(B);if(!Y.success)return{config:null,errors:Y.error.issues.map((J)=>({...G&&{file:G},path:J.path.join("."),message:"Does not adhere to MCP server configuration schema",mcpErrorMetadata:{scope:Z,severity:"fatal"}}))};let I=[],W={};for(let[J,X]of Object.entries(Y.data.mcpServers)){let F=X;if(Q){let{expanded:V,missingVars:K}=iw9(X);if(K.length>0)I.push({...G&&{file:G},path:`mcpServers.${J}`,message:`Missing environment variables: ${K.join(", ")}`,suggestion:`Set the following environment variables: ${K.join(", ")}`,mcpErrorMetadata:{scope:Z,serverName:J,severity:"warning"}});F=V}if(HB()==="windows"&&(!F.type||F.type==="stdio")&&(F.command==="npx"||F.command.endsWith("\\npx")||F.command.endsWith("/npx")))I.push({...G&&{file:G},path:`mcpServers.${J}`,message:"Windows requires 'cmd /c' wrapper to execute npx",suggestion:'Change command to "cmd" with args ["/c", "npx", ...]. See: https://docs.claude.com/en/docs/claude-code/mcp#configure-mcp-servers',mcpErrorMetadata:{scope:Z,serverName:J,severity:"warning"}});W[J]=F}return{config:{mcpServers:W},errors:I}}function o41(A){let{filePath:B,expandVars:Q,scope:Z}=A,G=w1();if(!G.existsSync(B))return{config:null,errors:[{file:B,path:"",message:`MCP config file not found: ${B}`,suggestion:"Check that the file path is correct",mcpErrorMetadata:{scope:Z,severity:"fatal"}}]};let Y;try{Y=G.readFileSync(B,{encoding:"utf8"})}catch(W){return{config:null,errors:[{file:B,path:"",message:`Failed to read file: ${W}`,suggestion:"Check file permissions and ensure the file exists",mcpErrorMetadata:{scope:Z,severity:"fatal"}}]}}let I=c3(Y);if(!I)return{config:null,errors:[{file:B,path:"",message:"MCP config is not a valid JSON",suggestion:"Fix the JSON syntax errors in the file",mcpErrorMetadata:{scope:Z,severity:"fatal"}}]};return r41({configObject:I,expandVars:Q,scope:Z,filePath:B})}function f10(){let{config:A}=o41({filePath:VU1(),expandVars:!0,scope:"enterprise"});return A!==null}function vH(A){return A.replace(/[^a-zA-Z0-9_-]/g,"_")}function t41(A,B){let Q=`mcp__${vH(B)}__`;return A.filter((Z)=>Z.name?.startsWith(Q))}function zU1(A,B){let Q=`mcp__${vH(B)}__`;return A.filter((Z)=>Z.name?.startsWith(Q))}function O$A(A,B){let Q=`mcp__${vH(B)}__`;return A.filter((Z)=>!Z.name?.startsWith(Q))}function R$A(A,B){let Q=`mcp__${vH(B)}__`;return A.filter((Z)=>!Z.name?.startsWith(Q))}function T$A(A,B){let Q={...A};return delete Q[B],Q}function P$A(A){return`mcp__${vH(A)}__`}function h10(A){return A.name?.startsWith("mcp__")||A.isMcp===!0}function tk(A){let B=A.split("__"),[Q,Z,...G]=B;if(Q!=="mcp"||!Z)return null;let Y=G.length>0?G.join("__"):void 0;return{serverName:Z,toolName:Y}}function HU1(A,B){let Q=`mcp__${vH(B)}__`;return A.replace(Q,"")}function DU1(A){let B=A.replace(/\s*\(MCP\)\s*$/,"");B=B.trim();let Q=B.indexOf(" - ");if(Q!==-1)return B.substring(Q+3).trim();return B}function bH(A){let B=w1();switch(A){case"user":{let Q=lJ(),Z=B.existsSync(Q);return`${Q}${Z?"":" (file does not exist)"}`}case"project":{let Q=nw9(QA(),".mcp.json"),Z=B.existsSync(Q);return`${Q}${Z?"":" (file does not exist)"}`}case"local":return`${lJ()} [project: ${QA()}]`;case"dynamic":return"Dynamically configured";case"enterprise":{let Q=VU1(),Z=B.existsSync(Q);return`${Q}${Z?"":" (file does not exist)"}`}default:return A}}function og(A){switch(A){case"local":return"Local config (private to you in this project)";case"project":return"Project config (shared via .mcp.json)";case"user":return"User config (available in all your projects)";case"dynamic":return"Dynamic config (from command line)";case"enterprise":return"Enterprise config (managed by your organization)";default:return A}}function e41(A){if(!A)return"local";if(!k10.options.includes(A))throw new Error(`Invalid scope: ${A}. Must be one of: ${k10.options.join(", ")}`);return A}function j$A(A){if(!A)return"stdio";if(A!=="stdio"&&A!=="sse"&&A!=="http")throw new Error(`Invalid transport type: ${A}. Must be one of: stdio, sse, http`);return A}function g10(A){let B={};for(let Q of A){let Z=Q.indexOf(":");if(Z===-1)throw new Error(`Invalid header format: "${Q}". Expected format: "Header-Name: value"`);let G=Q.substring(0,Z).trim(),Y=Q.substring(Z+1).trim();if(!G)throw new Error(`Invalid header: "${Q}". Header name cannot be empty.`);B[G]=Y}return B}function KU1(A){let B=M2(),Q=vH(A);if(B?.disabledMcpjsonServers?.some((Z)=>vH(Z)===Q))return"rejected";if(B?.enabledMcpjsonServers?.some((Z)=>vH(Z)===Q)||B?.enableAllProjectMcpServers)return"approved";return"pending"}var u10=[...yH,"cliArg","command","session"];function m10(A){switch(A){case"cliArg":return"CLI argument";case"command":return"command configuration";case"session":return"current session";case"localSettings":return"project local settings";case"projectSettings":return"project settings";case"policySettings":return"policy settings";case"userSettings":return"user settings";case"flagSettings":return"flag settings"}}function xH(A){let B=A.match(/^([^(]+)\(([^)]+)\)$/);if(!B)return{toolName:A};let Q=B[1],Z=B[2];if(!Q||!Z)return{toolName:A};return{toolName:Q,ruleContent:Z}}function r6(A){return A.ruleContent?`${A.toolName}(${A.ruleContent})`:A.toolName}function tg(A){return u10.flatMap((B)=>(A.alwaysAllowRules[B]||[]).map((Q)=>({source:B,ruleBehavior:"allow",ruleValue:xH(Q)})))}function aw9(A,B){return tg(A).filter((G)=>G.ruleValue.toolName===B).map((G)=>{if(G.ruleValue.ruleContent)return G.ruleValue.ruleContent;return B})}function HF(A,B,Q){if(Q)switch(Q.type){case"hook":return Q.reason?`Hook '${Q.hookName}' blocked this action: ${Q.reason}`:`Hook '${Q.hookName}' requires approval for this ${B} command`;case"rule":{let Y=r6(Q.rule.ruleValue),I=m10(Q.rule.source);return`Permission rule '${Y}' from ${I} requires approval for this ${B} command`}case"subcommandResults":{let Y=[];for(let[I,W]of Q.reasons)if(W.behavior==="ask"||W.behavior==="passthrough")Y.push(I);if(Y.length>0)return`This ${B} command contains multiple operations. The following part${Y.length>1?"s":""} require${Y.length>1?"":"s"} approval: ${Y.join(", ")}`;return`This ${B} command contains multiple operations that require approval`}case"permissionPromptTool":return`Tool '${Q.permissionPromptToolName}' requires approval for this ${B} command`;case"other":return Q.reason;case"mode":return`Current permission mode (${ng(Q.mode)}) requires approval for this ${B} command`}let Z=`Claude requested permissions to use ${B}, but you haven't granted it yet.`,G=aw9(A,B);if(G.length>0)Z+=`
/opt/homebrew/lib/node_modules/happy-coder/node_modules/@anthropic-ai/claude-code/cli.js:3549:`),K;try{K=JSON.parse(V.trim())}catch{let z=V.match(/\{[\s\S]*\}/);if(!z)throw new Error("No JSON object found in response");K=JSON.parse(z[0])}if(!K.identifier||!K.whenToUse||!K.systemPrompt)throw new Error("Invalid agent configuration generated");return Y1("tengu_agent_definition_generated",{agent_identifier:K.identifier}),{identifier:K.identifier,whenToUse:K.whenToUse,systemPrompt:K.systemPrompt}}function ZRB(){let{updateWizardData:A,goBack:B,goToStep:Q,wizardData:Z}=YZ(),[G,Y]=lX.useState(Z.generationPrompt||""),[I,W]=lX.useState(!1),[J,X]=lX.useState(null),[F,V]=lX.useState(G.length),K=kO(),z=lX.useRef(null);r0((C,w)=>{if(w.escape){if(I&&z.current)z.current.abort(),z.current=null,W(!1),X("Generation cancelled");else if(!I)A({generationPrompt:"",agentType:"",systemPrompt:"",whenToUse:"",generatedAgent:void 0,wasGenerated:!1}),Y(""),X(null),B()}});let H=async()=>{let C=G.trim();if(!C){X("Please describe what the agent should do");return}X(null),W(!0),A({generationPrompt:C,isGenerating:!0});let w=C4();z.current=w;try{let E=await QRB(C,K,[],w.signal);A({agentType:E.identifier,whenToUse:E.whenToUse,systemPrompt:E.systemPrompt,generatedAgent:E,isGenerating:!1,wasGenerated:!0}),Q(6)}catch(E){if(E instanceof Error&&!E.message.includes("No assistant message found"))X(E.message||"Failed to generate agent");A({isGenerating:!1})}finally{W(!1),z.current=null}},D="Describe what this agent should do and when it should be used (be comprehensive for best results)";if(I)return lX.default.createElement(tG,{subtitle:D,footerText:"Esc to cancel"},lX.default.createElement(y,{marginTop:1,flexDirection:"row",alignItems:"center"},lX.default.createElement(d6,null),lX.default.createElement(M,{color:"suggestion"}," Generating agent from description...")));return lX.default.createElement(tG,{subtitle:D,footerText:"Press Enter to submit · Esc to go back"},lX.default.createElement(y,{flexDirection:"column",marginTop:1},J&&lX.default.createElement(y,{marginBottom:1},lX.default.createElement(M,{color:"error"},J)),lX.default.createElement(s4,{value:G,onChange:Y,onSubmit:H,placeholder:"e.g., Help me write unit tests for my code...",columns:80,cursorOffset:F,onChangeCursorOffset:V,focus:!0,showCursor:!0})))}var a$=A1(V1(),1);function nR0(A){if(!A)return"Agent type is required";if(!/^[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]$/.test(A))return"Agent type must start and end with alphanumeric characters and contain only letters, numbers, and hyphens";if(A.length<3)return"Agent type must be at least 3 characters long";if(A.length>50)return"Agent type must be less than 50 characters";return null}function GRB(A,B,Q){let Z=[],G=[];if(!A.agentType)Z.push("Agent type is required");else{let Y=nR0(A.agentType);if(Y)Z.push(Y);let I=Q.find((W)=>W.agentType===A.agentType&&W.source!==A.source);if(I)Z.push(`Agent type "${A.agentType}" already exists in ${$21(I.source)}`)}if(!A.whenToUse)Z.push("Description (description) is required");else if(A.whenToUse.length<10)G.push("Description should be more descriptive (at least 10 characters)");else if(A.whenToUse.length>5000)G.push("Description is very long (over 5000 characters)");if(!A.tools||!Array.isArray(A.tools))Z.push("Tools must be an array");else{if(A.tools.length===0)G.push("No tools selected - agent will have very limited capabilities");let Y=W21(A.tools,B,A.source||"userSettings");if(Y.invalidTools.length>0)Z.push(`Invalid tools: ${Y.invalidTools.join(", ")}`);if(A.tools.includes("*"))G.push("Agent has access to all tools")}if(!A.systemPrompt)Z.push("System prompt is required");else if(A.systemPrompt.length<20)Z.push("System prompt is too short (minimum 20 characters)");else if(A.systemPrompt.length>1e4)G.push("System prompt is very long (over 10,000 characters)");return{isValid:Z.length===0,errors:Z,warnings:G}}function YRB(A){let{goNext:B,goBack:Q,updateWizardData:Z,wizardData:G}=YZ(),[Y,I]=a$.useState(G.agentType||""),[W,J]=a$.useState(null),[X,F]=a$.useState(Y.length);return r0((K,z)=>{if(z.escape)Q()}),a$.default.createElement(tG,{subtitle:"Agent type (identifier)",footerText:"Type to enter text · Enter to continue · Esc to go back"},a$.default.createElement(y,{flexDirection:"column",marginTop:1},a$.default.createElement(M,null,"Enter a unique identifier for your agent:"),a$.default.createElement(y,{marginTop:1},a$.default.createElement(s4,{value:Y,onChange:I,onSubmit:(K)=>{let z=K.trim(),H=nR0(z);if(H){J(H);return}J(null),Z({agentType:z}),B()},placeholder:"e.g., code-reviewer, tech-lead, etc",columns:60,cursorOffset:X,onChangeCursorOffset:F,focus:!0,showCursor:!0})),W&&a$.default.createElement(y,{marginTop:1},a$.default.createElement(M,{color:"error"},W))))}var pD=A1(V1(),1);function IRB(){let{goNext:A,goBack:B,updateWizardData:Q,wizardData:Z}=YZ(),[G,Y]=pD.useState(Z.systemPrompt||""),[I,W]=pD.useState(G.length),[J,X]=pD.useState(null);return r0((V,K)=>{if(K.escape)B()}),pD.default.createElement(tG,{subtitle:"System prompt",footerText:"Type to enter text · Enter to continue · Esc to go back"},pD.default.createElement(y,{flexDirection:"column",marginTop:1},pD.default.createElement(M,null,"Enter the system prompt for your agent:"),pD.default.createElement(M,{dimColor:!0},"Be comprehensive for best results"),pD.default.createElement(y,{marginTop:1},pD.default.createElement(s4,{value:G,onChange:Y,onSubmit:()=>{let V=G.trim();if(!V){X("System prompt is required");return}X(null),Q({systemPrompt:V}),A()},placeholder:"You are a helpful code reviewer who...",columns:80,cursorOffset:I,onChangeCursorOffset:W,focus:!0,showCursor:!0})),J&&pD.default.createElement(y,{marginTop:1},pD.default.createElement(M,{color:"error"},J))))}var s$=A1(V1(),1);function WRB(){let{goNext:A,goBack:B,updateWizardData:Q,wizardData:Z}=YZ(),[G,Y]=s$.useState(Z.whenToUse||""),[I,W]=s$.useState(G.length),[J,X]=s$.useState(null);return r0((V,K)=>{if(K.escape)B()}),s$.default.createElement(tG,{subtitle:"Description (tell Claude when to use this agent)",footerText:"Type to enter text · Enter to continue · Esc to go back"},s$.default.createElement(y,{flexDirection:"column",marginTop:1},s$.default.createElement(M,null,"When should Claude use this agent?"),s$.default.createElement(y,{marginTop:1},s$.default.createElement(s4,{value:G,onChange:Y,onSubmit:(V)=>{let K=V.trim();if(!K){X("Description is required");return}X(null),Q({whenToUse:K}),A()},placeholder:"e.g., use this agent after you're done writing code...",columns:80,cursorOffset:I,onChangeCursorOffset:W,focus:!0,showCursor:!0})),J&&s$.default.createElement(y,{marginTop:1},s$.default.createElement(M,{color:"error"},J))))}var aR0=A1(V1(),1);var kI=A1(V1(),1);var JRB=()=>({READ_ONLY:{name:"Read-only tools",toolNames:new Set([yE.name,TS.name,UO.name,Q6.name,MJ.name,XG.name,Ou1.name,Lu1.name,Mu1.name,N01.name,L01.name])},EDIT:{name:"Edit tools",toolNames:new Set([TY.name,zE.name,mF.name,cO.name])},EXECUTION:{name:"Execution tools",toolNames:new Set([hQ.name,void 0].filter(Boolean))},MCP:{name:"MCP tools",toolNames:new Set,isMcp:!0},OTHER:{name:"Other tools",toolNames:new Set}});function sV5(A){let B=new Map;return A.forEach((Q)=>{if(h10(Q)){let Z=tk(Q.name);if(Z?.serverName){let G=B.get(Z.serverName)||[];G.push(Q),B.set(Z.serverName,G)}}}),Array.from(B.entries()).map(([Q,Z])=>({serverName:Q,tools:Z})).sort((Q,Z)=>Q.serverName.localeCompare(Z.serverName))}function Su1({tools:A,initialTools:B,onComplete:Q,onCancel:Z}){let G=kI.useMemo(()=>cOB(A),[A]),Y=B.includes("*")?G.map((S)=>S.name):B,[I,W]=kI.useState(Y),[J,X]=kI.useState(0),[F,V]=kI.useState(!1),K=kI.useMemo(()=>{let S=new Set(G.map((d)=>d.name));return I.filter((d)=>S.has(d))},[I,G]),z=new Set(K),H=K.length===G.length&&G.length>0,D=(S)=>{if(!S)return;W((d)=>d.includes(S)?d.filter((u)=>u!==S):[...d,S])},C=(S,d)=>{W((u)=>{if(d){let o=S.filter((m)=>!u.includes(m));return[...u,...o]}else return u.filter((o)=>!S.includes(o))})},w=()=>{let S=G.map((o)=>o.name),u=K.length===S.length&&S.every((o)=>K.includes(o))?["*"]:K;Q(u)},E=kI.useMemo(()=>{let S=JRB(),d={readOnly:[],edit:[],execution:[],mcp:[],other:[]};return G.forEach((u)=>{if(h10(u))d.mcp.push(u);else if(S.READ_ONLY.toolNames.has(u.name))d.readOnly.push(u);else if(S.EDIT.toolNames.has(u.name))d.edit.push(u);else if(S.EXECUTION.toolNames.has(u.name))d.execution.push(u);else if(u.name!==s3)d.other.push(u)}),d},[G]),L=(S)=>{let u=S.filter((o)=>z.has(o.name)).length<S.length;return()=>{let o=S.map((m)=>m.name);C(o,u)}},O=[];O.push({id:"continue",label:"Continue",action:w,isContinue:!0}),O.push({id:"bucket-all",label:`${H?e0.checkboxOn:e0.checkboxOff} All tools`,action:()=>{let S=G.map((d)=>d.name);C(S,!H)}});let R=JRB();[{id:"bucket-readonly",name:R.READ_ONLY.name,tools:E.readOnly},{id:"bucket-edit",name:R.EDIT.name,tools:E.edit},{id:"bucket-execution",name:R.EXECUTION.name,tools:E.execution},{id:"bucket-mcp",name:R.MCP.name,tools:E.mcp},{id:"bucket-other",name:R.OTHER.name,tools:E.other}].forEach(({id:S,name:d,tools:u})=>{if(u.length===0)return;let m=u.filter((j)=>z.has(j.name)).length===u.length;O.push({id:S,label:`${m?e0.checkboxOn:e0.checkboxOff} ${d}`,action:L(u)})});let k=O.length;O.push({id:"toggle-individual",label:F?"Hide advanced options":"Show advanced options",action:()=>{if(V(!F),F&&J>k)X(k)},isToggle:!0});let b=kI.useMemo(()=>sV5(G),[G]);if(F){if(b.length>0)O.push({id:"mcp-servers-header",label:"MCP Servers:",action:()=>{},isHeader:!0}),b.forEach(({serverName:S,tools:d})=>{let o=d.filter((m)=>z.has(m.name)).length===d.length;O.push({id:`mcp-server-${S}`,label:`${o?e0.checkboxOn:e0.checkboxOff} ${S} (${d.length} tool${d.length===1?"":"s"})`,action:()=>{let m=d.map((j)=>j.name);C(m,!o)}})}),O.push({id:"tools-header",label:"Individual Tools:",action:()=>{},isHeader:!0});G.forEach((S)=>{let d=S.name;if(S.name.startsWith("mcp__")){let u=tk(S.name);d=u?`${u.toolName} (${u.serverName})`:S.name}O.push({id:`tool-${S.name}`,label:`${z.has(S.name)?e0.checkboxOn:e0.checkboxOff} ${d}`,action:()=>D(S.name)})})}return r0((S,d)=>{if(d.return){let u=O[J];if(u&&!u.isHeader)u.action()}else if(d.escape)if(Z)Z();else Q(B);else if(d.upArrow){let u=J-1;while(u>0&&O[u]?.isHeader)u--;X(Math.max(0,u))}else if(d.downArrow){let u=J+1;while(u<O.length-1&&O[u]?.isHeader)u++;X(Math.min(O.length-1,u))}}),kI.default.createElement(y,{flexDirection:"column",marginTop:1},kI.default.createElement(M,{color:J===0?"suggestion":void 0,bold:J===0},J===0?`${e0.pointer} `:"  ","[ Continue ]"),kI.default.createElement(M,{dimColor:!0},"─".repeat(40)),O.slice(1).map((S,d)=>{let u=d+1===J,o=S.isToggle,m=S.isHeader;return kI.default.createElement(kI.default.Fragment,{key:S.id},o&&kI.default.createElement(M,{dimColor:!0},"─".repeat(40)),m&&d>0&&kI.default.createElement(y,{marginTop:1}),kI.default.createElement(M,{color:m?void 0:u?"suggestion":void 0,dimColor:m,bold:o&&u},m?"":u?`${e0.pointer} `:"  ",o?`[ ${S.label} ]`:S.label))}),kI.default.createElement(y,{marginTop:1,flexDirection:"column"},kI.default.createElement(M,{dimColor:!0},H?"All tools selected":`${z.size} of ${G.length} tools selected`)))}function XRB({tools:A}){let{goNext:B,goBack:Q,updateWizardData:Z,wizardData:G}=YZ(),Y=(W)=>{Z({selectedTools:W}),B()},I=G.selectedTools||A.map((W)=>W.name);return aR0.default.createElement(tG,{subtitle:"Select tools",footerText:"Press Enter to toggle selection · ↑↓ to navigate · Esc to go back"},aR0.default.createElement(Su1,{tools:A,initialTools:I,onComplete:Y,onCancel:Q}))}var sR0=A1(V1(),1);var r$=A1(V1(),1);function yu1({initialModel:A,onComplete:B,onCancel:Q}){let Z=r$.useMemo(()=>VF2(),[]),G=r$.useMemo(()=>{if(A&&Z.some((Y)=>Y.value===A))return A;return"sonnet"},[A,Z]);return r$.createElement(y,{flexDirection:"column"},r$.createElement(y,{marginBottom:1},r$.createElement(M,{dimColor:!0},"Model determines the agent's reasoning capabilities and speed.")),r$.createElement(vA,{options:Z,defaultValue:G,onChange:(Y)=>{B(Y)},onCancel:()=>Q?Q():B(A)}))}function FRB(){let{goNext:A,goBack:B,updateWizardData:Q,wizardData:Z}=YZ(),G=(Y)=>{Q({selectedModel:Y}),A()};return sR0.default.createElement(tG,{subtitle:"Select model",footerText:"Press ↑↓ to navigate · Enter to select · Esc to go back"},sR0.default.createElement(yu1,{initialModel:Z.selectedModel,onComplete:G,onCancel:B}))}var _u1=A1(V1(),1);var KK=A1(V1(),1);var w21=["automatic",...Nb];function ku1({agentName:A,currentColor:B="automatic",onConfirm:Q}){let[Z,G]=KK.useState(Math.max(0,w21.findIndex((I)=>I===B)));r0((I,W)=>{if(W.upArrow)G((J)=>J>0?J-1:w21.length-1);else if(W.downArrow)G((J)=>J<w21.length-1?J+1:0);else if(W.return){let J=w21[Z];Q(J==="automatic"?void 0:J)}});let Y=w21[Z];return KK.default.createElement(y,{flexDirection:"column",gap:1},KK.default.createElement(y,{flexDirection:"column"},w21.map((I,W)=>{let J=W===Z;return KK.default.createElement(y,{key:I,flexDirection:"row",gap:1},KK.default.createElement(M,{color:J?"suggestion":void 0},J?e0.pointer:" "),I==="automatic"?KK.default.createElement(M,{bold:J},"Automatic color"):KK.default.createElement(y,{gap:1},KK.default.createElement(M,{backgroundColor:$I1[I],color:"inverseText"}," "),KK.default.createElement(M,{bold:J},I.charAt(0).toUpperCase()+I.slice(1))))})),KK.default.createElement(y,{marginTop:1},KK.default.createElement(M,null,"Preview: "),Y===void 0||Y==="automatic"?KK.default.createElement(M,{inverse:!0,bold:!0}," ",A," "):KK.default.createElement(M,{backgroundColor:$I1[Y],color:"inverseText",bold:!0}," ",A," ")))}function VRB(){let{goNext:A,goBack:B,updateWizardData:Q,wizardData:Z}=YZ();r0((Y,I)=>{if(I.escape)B()});let G=(Y)=>{Q({selectedColor:Y,finalAgent:{agentType:Z.agentType,whenToUse:Z.whenToUse,systemPrompt:Z.systemPrompt,tools:Z.selectedTools||[],...Z.selectedModel?{model:Z.selectedModel}:{},...Y?{color:Y}:{},source:Z.location}}),A()};return _u1.default.createElement(tG,{subtitle:"Choose background color",footerText:"Press ↑↓ to navigate · Enter to select · Esc to go back"},_u1.default.createElement(y,{marginTop:1},_u1.default.createElement(ku1,{agentName:Z.agentType||"agent",currentColor:"automatic",onConfirm:G})))}var tc=A1(V1(),1);var w5=A1(V1(),1);function KRB({tools:A,existingAgents:B,onSave:Q,onSaveAndEdit:Z,error:G}){let{goBack:Y,wizardData:I}=YZ();r0((F,V)=>{if(V.escape)Y();else if(F==="s"||V.return)Q();else if(F==="e")Z()});let W=I.finalAgent,J=GRB(W,A,B),X=(F)=>{if(!F||F.length===0)return"None";if(F.length===1)return F[0]||"None";if(F.length===2)return F.join(" and ");return`${F.slice(0,-1).join(", ")}, and ${F[F.length-1]}`};return w5.default.createElement(tG,{subtitle:"Confirm and save",footerText:"Press s/Enter to save · e to edit in your editor · Esc to cancel"},w5.default.createElement(y,{flexDirection:"column",marginTop:1},w5.default.createElement(M,null,w5.default.createElement(M,{bold:!0},"Name"),": ",W.agentType),w5.default.createElement(M,null,w5.default.createElement(M,{bold:!0},"Location"),":"," ",aOB({source:I.location,agentType:W.agentType})),w5.default.createElement(M,null,w5.default.createElement(M,{bold:!0},"Tools"),": ",X(W.tools)),w5.default.createElement(M,null,w5.default.createElement(M,{bold:!0},"Model"),": ",hR1(W.model)),w5.default.createElement(y,{marginTop:1},w5.default.createElement(M,null,w5.default.createElement(M,{bold:!0},"Description")," (tells Claude when to use this agent):")),w5.default.createElement(y,{marginLeft:2,marginTop:1},w5.default.createElement(M,null,W.whenToUse.length>240?W.whenToUse.slice(0,240)+"…":W.whenToUse)),w5.default.createElement(y,{marginTop:1},w5.default.createElement(M,null,w5.default.createElement(M,{bold:!0},"System prompt"),":")),w5.default.createElement(y,{marginLeft:2,marginTop:1},w5.default.createElement(M,null,W.systemPrompt.length>240?W.systemPrompt.slice(0,240)+"…":W.systemPrompt)),J.warnings.length>0&&w5.default.createElement(y,{marginTop:1,flexDirection:"column"},w5.default.createElement(M,{color:"warning"},"Warnings:"),J.warnings.map((F,V)=>w5.default.createElement(M,{key:V,dimColor:!0}," ","• ",F))),J.errors.length>0&&w5.default.createElement(y,{marginTop:1,flexDirection:"column"},w5.default.createElement(M,{color:"error"},"Errors:"),J.errors.map((F,V)=>w5.default.createElement(M,{key:V,color:"error"}," ","• ",F))),G&&w5.default.createElement(y,{marginTop:1},w5.default.createElement(M,{color:"error"},G)),w5.default.createElement(y,{marginTop:2},w5.default.createElement(M,{color:"success"},"Press ",w5.default.createElement(M,{bold:!0},"s")," or ",w5.default.createElement(M,{bold:!0},"Enter")," to save,"," ",w5.default.createElement(M,{bold:!0},"e")," to save and edit"))))}function zRB({tools:A,existingAgents:B,onComplete:Q}){let{wizardData:Z}=YZ(),[G,Y]=tc.useState(null),I=tc.useCallback(async()=>{if(!Z?.finalAgent)return;try{await dR0(Z.location,Z.finalAgent.agentType,Z.finalAgent.whenToUse,Z.finalAgent.tools,Z.finalAgent.systemPrompt,!0,Z.finalAgent.color,Z.finalAgent.model),Zc(),Y1("tengu_agent_created",{agent_type:Z.finalAgent.agentType,generation_method:Z.wasGenerated?"generated":"manual",source:Z.location,tool_count:Z.finalAgent.tools.length,has_custom_model:!!Z.finalAgent.model,has_custom_color:!!Z.finalAgent.color}),Q(`Created agent: ${n1.bold(Z.finalAgent.agentType)}`)}catch(J){Y(J instanceof Error?J.message:"Failed to save agent")}},[Z,Q]),W=tc.useCallback(async()=>{if(!Z?.finalAgent)return;try{await dR0(Z.location,Z.finalAgent.agentType,Z.finalAgent.whenToUse,Z.finalAgent.tools,Z.finalAgent.systemPrompt,!0,Z.finalAgent.color,Z.finalAgent.model),Zc();let J=mR0({source:Z.location,agentType:Z.finalAgent.agentType});await $A1(J),Y1("tengu_agent_created",{agent_type:Z.finalAgent.agentType,generation_method:Z.wasGenerated?"generated":"manual",source:Z.location,tool_count:Z.finalAgent.tools.length,has_custom_model:!!Z.finalAgent.model,has_custom_color:!!Z.finalAgent.color,opened_in_editor:!0}),Q(`Created agent: ${n1.bold(Z.finalAgent.agentType)} and opened in editor. If you made edits, restart to load the latest version.`)}catch(J){Y(J instanceof Error?J.message:"Failed to save agent")}},[Z,Q]);return tc.default.createElement(KRB,{tools:A,existingAgents:B,onSave:I,onSaveAndEdit:W,error:G})}function HRB({tools:A,existingAgents:B,onComplete:Q,onCancel:Z}){return wJ1.default.createElement(lR0,{steps:[ARB,BRB,ZRB,()=>wJ1.default.createElement(YRB,{existingAgents:B}),IRB,WRB,()=>wJ1.default.createElement(XRB,{tools:A}),FRB,VRB,()=>wJ1.default.createElement(zRB,{tools:A,existingAgents:B,onComplete:Q})],initialData:{},onComplete:()=>{},onCancel:Z,title:"Create new agent",showStepCounter:!1})}var CW=A1(V1(),1),o$=A1(V1(),1);function DRB({agent:A,tools:B,onSaved:Q,onBack:Z}){let[G,Y]=o$.useState("menu"),[I,W]=o$.useState(0),[J,X]=o$.useState(null),[F,V]=o$.useState(A.color),K=o$.useCallback(async()=>{try{let E=Tu1(A);await $A1(E),Q(`Opened ${A.agentType} in editor. If you made edits, restart to load the latest version.`)}catch(E){X(E instanceof Error?E.message:"Failed to open editor")}},[A,Q]),z=o$.useCallback(async(E={})=>{let{tools:L,color:O,model:R}=E,P=O??F,k=L!==void 0,b=R!==void 0,S=P!==A.color;if(!k&&!b&&!S)return!1;try{if(await rOB(A,A.whenToUse,L??A.tools,A.systemPrompt,P,R??A.model),S&&P)n01(A.agentType,P);return Zc(),Q(`Updated agent: ${n1.bold(A.agentType)}`),!0}catch(d){return X(d instanceof Error?d.message:"Failed to save agent"),!1}},[A,F,Q]),H=o$.useMemo(()=>[{label:"Open in editor",action:K},{label:"Edit tools",action:()=>Y("edit-tools")},{label:"Edit model",action:()=>Y("edit-model")},{label:"Edit color",action:()=>Y("edit-color")}],[K]),D=o$.useCallback(()=>{if(X(null),G==="menu")Z();else Y("menu")},[G,Z]),C=o$.useCallback((E)=>{if(E.upArrow)W((L)=>Math.max(0,L-1));else if(E.downArrow)W((L)=>Math.min(H.length-1,L+1));else if(E.return){let L=H[I];if(L)L.action()}},[H,I]);r0((E,L)=>{if(L.escape){D();return}if(G==="menu")C(L)});let w=()=>CW.createElement(y,{flexDirection:"column"},CW.createElement(M,{dimColor:!0},"Source: ",$21(A.source)),CW.createElement(y,{marginTop:1,flexDirection:"column"},H.map((E,L)=>CW.createElement(M,{key:E.label,color:L===I?"suggestion":void 0},L===I?`${e0.pointer} `:"  ",E.label))),J&&CW.createElement(y,{marginTop:1},CW.createElement(M,{color:"error"},J)));switch(G){case"menu":return w();case"edit-tools":return CW.createElement(Su1,{tools:B,initialTools:A.tools,onComplete:async(E)=>{Y("menu"),await z({tools:E})}});case"edit-color":return CW.createElement(ku1,{agentName:A.agentType,currentColor:F||A.color||"automatic",onConfirm:async(E)=>{V(E),Y("menu"),await z({color:E})}});case"edit-model":return CW.createElement(yu1,{initialModel:A.model,onComplete:async(E)=>{Y("menu"),await z({model:E})}});default:return null}}var xQ=A1(V1(),1);function CRB({agent:A,tools:B,onBack:Q}){let[Z]=oB(),G=W21(A.tools,B,A.source),Y=sOB(A),I=i01(A.agentType);r0((J,X)=>{if(X.escape||X.return)Q()});function W(){if(G.hasWildcard)return xQ.createElement(M,null,"All tools");if(A.tools.length===0)return xQ.createElement(M,null,"None");return xQ.createElement(xQ.Fragment,null,G.validTools.length>0&&xQ.createElement(M,null,G.validTools.join(", ")),G.invalidTools.length>0&&xQ.createElement(M,{color:"warning"},e0.warning," Unrecognized:"," ",G.invalidTools.join(", ")))}return xQ.createElement(y,{flexDirection:"column",gap:1},xQ.createElement(M,{dimColor:!0},Y),xQ.createElement(y,{flexDirection:"column"},xQ.createElement(M,null,xQ.createElement(M,{bold:!0},"Description")," (tells Claude when to use this agent):"),xQ.createElement(y,{marginLeft:2},xQ.createElement(M,null,A.whenToUse))),xQ.createElement(y,null,xQ.createElement(M,null,xQ.createElement(M,{bold:!0},"Tools"),":"," "),W()),xQ.createElement(M,null,xQ.createElement(M,{bold:!0},"Model"),": ",hR1(A.model)),I&&xQ.createElement(y,null,xQ.createElement(M,null,xQ.createElement(M,{bold:!0},"Color"),":"," ",xQ.createElement(M,{backgroundColor:I,color:"inverseText"}," ",A.agentType," "))),xQ.createElement(y,null,xQ.createElement(M,null,xQ.createElement(M,{bold:!0},"System prompt"),":")),xQ.createElement(y,{marginLeft:2,marginRight:2},xQ.createElement(M,null,TX(A.systemPrompt,Z))))}var qJ1=A1(V1(),1);function q21({instructions:A="Press ↑↓ to navigate · Enter to select · Esc to go back"}){let B=G2();return qJ1.createElement(y,{marginLeft:3},qJ1.createElement(M,{dimColor:!0},B.pending?`Press ${B.keyName} again to exit`:A))}function URB({tools:A,onExit:B,initialAgents:Q,initialAllAgents:Z}){let[G,Y]=iD.useState({mode:"list-agents",source:"all"}),[I,W]=iD.useState(Q),[J,X]=iD.useState(Z),[F,V]=iD.useState([]),[K,z]=iD.useState(0),H=Q.length>0||Z.length>0,[D]=dB(),C=Ku1(A,D.mcp.tools);G2(),iD.useEffect(()=>{if(H&&K===0)return;async function O(){try{let R=await k$();W(R.activeAgents),X(R.allAgents)}catch(R){U1(R instanceof Error?R:new Error("Failed to load agents"),S3A)}}O()},[K,H]);let w=iD.useMemo(()=>({"built-in":J.filter((O)=>O.source==="built-in"),userSettings:J.filter((O)=>O.source==="userSettings"),projectSettings:J.filter((O)=>O.source==="projectSettings"),policySettings:J.filter((O)=>O.source==="policySettings"),localSettings:J.filter((O)=>O.source==="localSettings"),flagSettings:J.filter((O)=>O.source==="flagSettings"),plugin:J.filter((O)=>O.source==="plugin"),all:J}),[J]);r0((O,R)=>{if(!R.escape)return;let P=F.length>0?`Agent changes:
